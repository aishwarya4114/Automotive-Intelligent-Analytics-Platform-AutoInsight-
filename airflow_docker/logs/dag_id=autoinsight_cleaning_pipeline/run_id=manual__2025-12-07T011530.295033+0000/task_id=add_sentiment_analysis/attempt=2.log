[2025-12-07T01:28:58.825+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline.add_sentiment_analysis manual__2025-12-07T01:15:30.295033+00:00 [queued]>
[2025-12-07T01:28:58.841+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline.add_sentiment_analysis manual__2025-12-07T01:15:30.295033+00:00 [queued]>
[2025-12-07T01:28:58.843+0000] {taskinstance.py:1361} INFO - Starting attempt 2 of 4
[2025-12-07T01:28:58.868+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): add_sentiment_analysis> on 2025-12-07 01:15:30.295033+00:00
[2025-12-07T01:28:58.881+0000] {standard_task_runner.py:57} INFO - Started process 238 to run task
[2025-12-07T01:28:58.886+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'autoinsight_cleaning_pipeline', 'add_sentiment_analysis', 'manual__2025-12-07T01:15:30.295033+00:00', '--job-id', '159', '--raw', '--subdir', 'DAGS_FOLDER/autoinsight_cleaning_pipeline.py', '--cfg-path', '/tmp/tmpzbay8grl']
[2025-12-07T01:28:58.891+0000] {standard_task_runner.py:85} INFO - Job 159: Subtask add_sentiment_analysis
[2025-12-07T01:28:58.997+0000] {task_command.py:416} INFO - Running <TaskInstance: autoinsight_cleaning_pipeline.add_sentiment_analysis manual__2025-12-07T01:15:30.295033+00:00 [running]> on host fb35e4f278df
[2025-12-07T01:28:59.112+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='autoinsight@example.com' AIRFLOW_CTX_DAG_OWNER='autoinsight-team' AIRFLOW_CTX_DAG_ID='autoinsight_cleaning_pipeline' AIRFLOW_CTX_TASK_ID='add_sentiment_analysis' AIRFLOW_CTX_EXECUTION_DATE='2025-12-07T01:15:30.295033+00:00' AIRFLOW_CTX_TRY_NUMBER='2' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-12-07T01:15:30.295033+00:00'
[2025-12-07T01:28:59.114+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T01:28:59.115+0000] {logging_mixin.py:154} INFO - ADDING CUSTOM SENTIMENT ANALYSIS (Post-Processing)
[2025-12-07T01:28:59.116+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T01:29:04.817+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T01:29:04.818+0000] {logging_mixin.py:154} INFO - ADDING CUSTOM SENTIMENT ANALYSIS TO SNOWFLAKE COMPLAINTS
[2025-12-07T01:29:04.819+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T01:29:04.819+0000] {logging_mixin.py:154} INFO - 
Step 1: Connecting to Snowflake...
[2025-12-07T01:29:04.820+0000] {connection.py:386} INFO - Snowflake Connector for Python Version: 3.7.0, Python Version: 3.11.6, Platform: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.31
[2025-12-07T01:29:04.821+0000] {connection.py:1211} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-12-07T01:29:06.578+0000] {logging_mixin.py:154} INFO - ✅ Connected to Snowflake
[2025-12-07T01:29:06.580+0000] {logging_mixin.py:154} INFO - 
Step 2: Verifying sentiment columns exist in FACT_COMPLAINTS...
[2025-12-07T01:29:06.581+0000] {cursor.py:1032} INFO - query: [DESCRIBE TABLE FACT_COMPLAINTS]
[2025-12-07T01:29:06.678+0000] {cursor.py:1045} INFO - query execution done
[2025-12-07T01:29:06.679+0000] {cursor.py:1205} INFO - Number of results in first chunk: 28
[2025-12-07T01:29:06.680+0000] {logging_mixin.py:154} INFO - ❌ Missing columns: ['SENTIMENT_SCORE', 'SENTIMENT_LABEL', 'SENTIMENT_CONFIDENCE', 'SENTIMENT_CATEGORY', 'NEGATION_COUNT', 'SAFETY_KEYWORD_COUNT']
[2025-12-07T01:29:06.682+0000] {logging_mixin.py:154} INFO - ERROR: Please add sentiment columns to FACT_COMPLAINTS table first!
[2025-12-07T01:29:06.683+0000] {logging_mixin.py:154} INFO - Run this SQL in Snowflake:
[2025-12-07T01:29:06.684+0000] {logging_mixin.py:154} INFO - 
        ALTER TABLE FACT_COMPLAINTS ADD COLUMN sentiment_score FLOAT;
        ALTER TABLE FACT_COMPLAINTS ADD COLUMN sentiment_label VARCHAR(20);
        ALTER TABLE FACT_COMPLAINTS ADD COLUMN sentiment_confidence FLOAT;
        ALTER TABLE FACT_COMPLAINTS ADD COLUMN sentiment_category VARCHAR(20);
        ALTER TABLE FACT_COMPLAINTS ADD COLUMN negation_count INTEGER;
        ALTER TABLE FACT_COMPLAINTS ADD COLUMN safety_keyword_count INTEGER;
        
[2025-12-07T01:29:06.685+0000] {logging_mixin.py:154} INFO - ❌ Sentiment Analysis Failed: Sentiment columns missing from table
[2025-12-07T01:29:06.692+0000] {logging_mixin.py:154} WARNING - Traceback (most recent call last):
[2025-12-07T01:29:06.693+0000] {logging_mixin.py:154} WARNING -   File "/opt/***/dags/autoinsight_cleaning_pipeline.py", line 405, in add_sentiment_to_complaints
    sentiment_main()
[2025-12-07T01:29:06.694+0000] {logging_mixin.py:154} WARNING -   File "/opt/***/src/add_sentiment_to_snowflake.py", line 105, in main
    raise Exception("Sentiment columns missing from table")
[2025-12-07T01:29:06.695+0000] {logging_mixin.py:154} WARNING - Exception: Sentiment columns missing from table
[2025-12-07T01:29:06.697+0000] {taskinstance.py:1937} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/autoinsight_cleaning_pipeline.py", line 405, in add_sentiment_to_complaints
    sentiment_main()
  File "/opt/airflow/src/add_sentiment_to_snowflake.py", line 105, in main
    raise Exception("Sentiment columns missing from table")
Exception: Sentiment columns missing from table
[2025-12-07T01:29:06.717+0000] {taskinstance.py:1400} INFO - Marking task as UP_FOR_RETRY. dag_id=autoinsight_cleaning_pipeline, task_id=add_sentiment_analysis, execution_date=20251207T011530, start_date=20251207T012858, end_date=20251207T012906
[2025-12-07T01:29:06.737+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 159 for task add_sentiment_analysis (Sentiment columns missing from table; 238)
[2025-12-07T01:29:06.798+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2025-12-07T01:29:06.818+0000] {taskinstance.py:2778} INFO - 0 downstream tasks scheduled from follow-on schedule check
