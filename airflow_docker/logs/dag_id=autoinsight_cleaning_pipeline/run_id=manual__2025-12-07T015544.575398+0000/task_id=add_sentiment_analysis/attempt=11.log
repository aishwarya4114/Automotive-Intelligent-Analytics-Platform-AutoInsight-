[2025-12-07T07:24:16.414+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline.add_sentiment_analysis manual__2025-12-07T01:55:44.575398+00:00 [queued]>
[2025-12-07T07:24:16.426+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline.add_sentiment_analysis manual__2025-12-07T01:55:44.575398+00:00 [queued]>
[2025-12-07T07:24:16.428+0000] {taskinstance.py:1361} INFO - Starting attempt 11 of 13
[2025-12-07T07:24:16.447+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): add_sentiment_analysis> on 2025-12-07 01:55:44.575398+00:00
[2025-12-07T07:24:16.456+0000] {standard_task_runner.py:57} INFO - Started process 224 to run task
[2025-12-07T07:24:16.462+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'autoinsight_cleaning_pipeline', 'add_sentiment_analysis', 'manual__2025-12-07T01:55:44.575398+00:00', '--job-id', '196', '--raw', '--subdir', 'DAGS_FOLDER/autoinsight_cleaning_pipeline.py', '--cfg-path', '/tmp/tmp3pjimlg5']
[2025-12-07T07:24:16.467+0000] {standard_task_runner.py:85} INFO - Job 196: Subtask add_sentiment_analysis
[2025-12-07T07:24:16.567+0000] {task_command.py:416} INFO - Running <TaskInstance: autoinsight_cleaning_pipeline.add_sentiment_analysis manual__2025-12-07T01:55:44.575398+00:00 [running]> on host fb35e4f278df
[2025-12-07T07:24:16.676+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='autoinsight@example.com' AIRFLOW_CTX_DAG_OWNER='autoinsight-team' AIRFLOW_CTX_DAG_ID='autoinsight_cleaning_pipeline' AIRFLOW_CTX_TASK_ID='add_sentiment_analysis' AIRFLOW_CTX_EXECUTION_DATE='2025-12-07T01:55:44.575398+00:00' AIRFLOW_CTX_TRY_NUMBER='11' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-12-07T01:55:44.575398+00:00'
[2025-12-07T07:24:16.678+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T07:24:16.679+0000] {logging_mixin.py:154} INFO - ADDING CUSTOM SENTIMENT ANALYSIS (Post-Processing)
[2025-12-07T07:24:16.680+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T07:24:21.912+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T07:24:21.914+0000] {logging_mixin.py:154} INFO - ADDING CUSTOM SENTIMENT ANALYSIS TO SNOWFLAKE COMPLAINTS
[2025-12-07T07:24:21.914+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T07:24:21.915+0000] {logging_mixin.py:154} INFO - 
Step 1: Connecting to Snowflake...
[2025-12-07T07:24:21.916+0000] {connection.py:386} INFO - Snowflake Connector for Python Version: 3.7.0, Python Version: 3.11.6, Platform: Linux-6.6.87.2-microsoft-standard-WSL2-x86_64-with-glibc2.31
[2025-12-07T07:24:21.917+0000] {connection.py:1211} INFO - This connection is in OCSP Fail Open Mode. TLS Certificates would be checked for validity and revocation status. Any other Certificate Revocation related exceptions or OCSP Responder failures would be disregarded in favor of connectivity.
[2025-12-07T07:24:23.787+0000] {logging_mixin.py:154} INFO - ✅ Connected to Snowflake
[2025-12-07T07:24:23.789+0000] {logging_mixin.py:154} INFO - 
Step 2: Verifying sentiment columns exist in FACT_COMPLAINTS...
[2025-12-07T07:24:23.790+0000] {cursor.py:1032} INFO - query: [DESCRIBE TABLE FACT_COMPLAINTS]
[2025-12-07T07:24:23.936+0000] {cursor.py:1045} INFO - query execution done
[2025-12-07T07:24:23.937+0000] {cursor.py:1205} INFO - Number of results in first chunk: 34
[2025-12-07T07:24:23.940+0000] {logging_mixin.py:154} INFO - ✅ All sentiment columns exist
[2025-12-07T07:24:23.941+0000] {logging_mixin.py:154} INFO - 
Step 3: Checking complaints needing sentiment analysis...
[2025-12-07T07:24:23.942+0000] {cursor.py:1032} INFO - query: [SELECT COUNT(*) FROM FACT_COMPLAINTS WHERE SENTIMENT_SCORE IS NULL]
[2025-12-07T07:24:24.111+0000] {cursor.py:1045} INFO - query execution done
[2025-12-07T07:24:24.117+0000] {cursor.py:1205} INFO - Number of results in first chunk: 1
[2025-12-07T07:24:24.119+0000] {logging_mixin.py:154} INFO - Found 74,799 complaints needing sentiment analysis
[2025-12-07T07:24:24.120+0000] {logging_mixin.py:154} INFO - 
Step 4: Loading sentiment models...
[2025-12-07T07:24:24.121+0000] {logging_mixin.py:154} INFO - ⏳ This may take 1-2 minutes on first run (downloading models)...
[2025-12-07T07:24:24.122+0000] {analyzer.py:29} INFO - Initializing ComplaintSentimentAnalyzer...
[2025-12-07T07:24:24.125+0000] {models.py:35} INFO - Loading sentiment model: cardiffnlp/twitter-roberta-base-sentiment-latest
[2025-12-07T07:24:24.135+0000] {logging_mixin.py:154} WARNING - /home/***/.local/lib/python3.11/site-packages/huggingface_hub/file_download.py:942 FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
[2025-12-07T07:24:25.500+0000] {logging_mixin.py:154} WARNING - Some weights of the model checkpoint at cardiffnlp/twitter-roberta-base-sentiment-latest were not used when initializing RobertaForSequenceClassification: ['roberta.pooler.dense.bias', 'roberta.pooler.dense.weight']
- This IS expected if you are initializing RobertaForSequenceClassification from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing RobertaForSequenceClassification from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
[2025-12-07T07:24:25.733+0000] {models.py:50} INFO - ✅ Sentiment model loaded (device: CPU)
[2025-12-07T07:24:25.735+0000] {models.py:104} INFO - Loading embedding model: sentence-transformers/all-mpnet-base-v2
[2025-12-07T07:24:26.557+0000] {models.py:114} INFO - ✅ Embedding model loaded (device: cpu)
[2025-12-07T07:24:26.558+0000] {analyzer.py:36} INFO - ✅ ComplaintSentimentAnalyzer ready
[2025-12-07T07:24:26.559+0000] {logging_mixin.py:154} INFO - ✅ Models loaded in 2.4 seconds
[2025-12-07T07:24:26.560+0000] {logging_mixin.py:154} INFO - 
Step 5: Processing 74,799 complaints in 1496 batches of 50...
[2025-12-07T07:24:26.560+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-07T07:24:26.561+0000] {cursor.py:1032} INFO - query: [SELECT complaint_id, complaint_description FROM FACT_COMPLAINTS WHERE SENTIMENT_...]
[2025-12-07T07:24:26.710+0000] {cursor.py:1045} INFO - query execution done
[2025-12-07T07:24:26.718+0000] {logging_mixin.py:154} INFO - ❌ Sentiment Analysis Failed: 000904 (42000): 01c0e2dc-0000-5190-0012-8cd3000115aa: SQL compilation error: error line 1 at position 7
invalid identifier 'COMPLAINT_ID'
[2025-12-07T07:24:26.724+0000] {logging_mixin.py:154} WARNING - Traceback (most recent call last):
[2025-12-07T07:24:26.726+0000] {logging_mixin.py:154} WARNING -   File "/opt/***/dags/autoinsight_cleaning_pipeline.py", line 406, in add_sentiment_to_complaints
    sentiment_main()
[2025-12-07T07:24:26.726+0000] {logging_mixin.py:154} WARNING -   File "/opt/***/src/add_sentiment_to_snowflake.py", line 150, in main
    cursor.execute(f"""
[2025-12-07T07:24:26.728+0000] {logging_mixin.py:154} WARNING -   File "/home/***/.local/lib/python3.11/site-packages/snowflake/connector/cursor.py", line 1136, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
[2025-12-07T07:24:26.728+0000] {logging_mixin.py:154} WARNING -   File "/home/***/.local/lib/python3.11/site-packages/snowflake/connector/errors.py", line 290, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[2025-12-07T07:24:26.729+0000] {logging_mixin.py:154} WARNING -   File "/home/***/.local/lib/python3.11/site-packages/snowflake/connector/errors.py", line 345, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
[2025-12-07T07:24:26.730+0000] {logging_mixin.py:154} WARNING -   File "/home/***/.local/lib/python3.11/site-packages/snowflake/connector/errors.py", line 221, in default_errorhandler
    raise error_class(
[2025-12-07T07:24:26.731+0000] {logging_mixin.py:154} WARNING - snowflake.connector.errors.ProgrammingError: 000904 (42000): 01c0e2dc-0000-5190-0012-8cd3000115aa: SQL compilation error: error line 1 at position 7
invalid identifier 'COMPLAINT_ID'
[2025-12-07T07:24:26.732+0000] {taskinstance.py:1937} ERROR - Task failed with exception
Traceback (most recent call last):
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/operators/python.py", line 192, in execute
    return_value = self.execute_callable()
                   ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/airflow/operators/python.py", line 209, in execute_callable
    return self.python_callable(*self.op_args, **self.op_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/opt/airflow/dags/autoinsight_cleaning_pipeline.py", line 406, in add_sentiment_to_complaints
    sentiment_main()
  File "/opt/airflow/src/add_sentiment_to_snowflake.py", line 150, in main
    cursor.execute(f"""
  File "/home/airflow/.local/lib/python3.11/site-packages/snowflake/connector/cursor.py", line 1136, in execute
    Error.errorhandler_wrapper(self.connection, self, error_class, errvalue)
  File "/home/airflow/.local/lib/python3.11/site-packages/snowflake/connector/errors.py", line 290, in errorhandler_wrapper
    handed_over = Error.hand_to_other_handler(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/airflow/.local/lib/python3.11/site-packages/snowflake/connector/errors.py", line 345, in hand_to_other_handler
    cursor.errorhandler(connection, cursor, error_class, error_value)
  File "/home/airflow/.local/lib/python3.11/site-packages/snowflake/connector/errors.py", line 221, in default_errorhandler
    raise error_class(
snowflake.connector.errors.ProgrammingError: 000904 (42000): 01c0e2dc-0000-5190-0012-8cd3000115aa: SQL compilation error: error line 1 at position 7
invalid identifier 'COMPLAINT_ID'
[2025-12-07T07:24:26.753+0000] {taskinstance.py:1400} INFO - Marking task as UP_FOR_RETRY. dag_id=autoinsight_cleaning_pipeline, task_id=add_sentiment_analysis, execution_date=20251207T015544, start_date=20251207T072416, end_date=20251207T072426
[2025-12-07T07:24:26.777+0000] {standard_task_runner.py:104} ERROR - Failed to execute job 196 for task add_sentiment_analysis (000904 (42000): 01c0e2dc-0000-5190-0012-8cd3000115aa: SQL compilation error: error line 1 at position 7
invalid identifier 'COMPLAINT_ID'; 224)
[2025-12-07T07:24:26.925+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 1
[2025-12-07T07:24:26.963+0000] {taskinstance.py:2778} INFO - 0 downstream tasks scheduled from follow-on schedule check
