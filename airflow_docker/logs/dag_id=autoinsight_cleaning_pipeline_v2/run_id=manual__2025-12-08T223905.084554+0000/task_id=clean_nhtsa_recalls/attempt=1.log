[2025-12-08T22:39:06.734+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_recalls manual__2025-12-08T22:39:05.084554+00:00 [queued]>
[2025-12-08T22:39:06.742+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_recalls manual__2025-12-08T22:39:05.084554+00:00 [queued]>
[2025-12-08T22:39:06.742+0000] {taskinstance.py:1361} INFO - Starting attempt 1 of 3
[2025-12-08T22:39:06.758+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): clean_nhtsa_recalls> on 2025-12-08 22:39:05.084554+00:00
[2025-12-08T22:39:06.763+0000] {standard_task_runner.py:57} INFO - Started process 4910 to run task
[2025-12-08T22:39:06.766+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'autoinsight_cleaning_pipeline_v2', 'clean_nhtsa_recalls', 'manual__2025-12-08T22:39:05.084554+00:00', '--job-id', '274', '--raw', '--subdir', 'DAGS_FOLDER/autoinsight_cleaning_pipeline.py', '--cfg-path', '/tmp/tmprkt0zc91']
[2025-12-08T22:39:06.770+0000] {standard_task_runner.py:85} INFO - Job 274: Subtask clean_nhtsa_recalls
[2025-12-08T22:39:06.837+0000] {task_command.py:416} INFO - Running <TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_recalls manual__2025-12-08T22:39:05.084554+00:00 [running]> on host 71216401ab91
[2025-12-08T22:39:06.905+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='autoinsight@example.com' AIRFLOW_CTX_DAG_OWNER='autoinsight-team' AIRFLOW_CTX_DAG_ID='autoinsight_cleaning_pipeline_v2' AIRFLOW_CTX_TASK_ID='clean_nhtsa_recalls' AIRFLOW_CTX_EXECUTION_DATE='2025-12-08T22:39:05.084554+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-12-08T22:39:05.084554+00:00'
[2025-12-08T22:39:06.906+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-08T22:39:06.907+0000] {logging_mixin.py:154} INFO - CLEANING TASK: NHTSA Recalls
[2025-12-08T22:39:06.907+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-08T22:39:07.002+0000] {logging_mixin.py:154} INFO - 
Starting NHTSA Recalls Cleaning
[2025-12-08T22:39:07.003+0000] {logging_mixin.py:154} INFO - Running in LOCAL mode
[2025-12-08T22:39:07.003+0000] {logging_mixin.py:154} INFO - Loading AWS S3 connectors...
[2025-12-08T22:39:16.819+0000] {logging_mixin.py:154} INFO - Input: s3a://autoinsightfinal/nhtsa/raw/recalls/*.csv
[2025-12-08T22:39:16.821+0000] {logging_mixin.py:154} INFO - Output: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/parquet/
[2025-12-08T22:39:16.821+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-08T22:39:16.822+0000] {logging_mixin.py:154} INFO - NHTSA RECALLS - SPARK CLEANING PIPELINE
[2025-12-08T22:39:16.823+0000] {logging_mixin.py:154} INFO - Input: 2020-2025 data (pre-filtered)
[2025-12-08T22:39:16.824+0000] {logging_mixin.py:154} INFO - Target: Top 15 manufacturers
[2025-12-08T22:39:16.825+0000] {logging_mixin.py:154} INFO - Output: Snowflake-ready with standardized columns
[2025-12-08T22:39:16.826+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-08T22:39:16.827+0000] {logging_mixin.py:154} INFO - 
Reading raw data from: s3a://autoinsightfinal/nhtsa/raw/recalls/*.csv
[2025-12-08T22:39:48.443+0000] {logging_mixin.py:154} INFO -   Loaded 230,540 records (includes duplicate documents)
[2025-12-08T22:39:48.490+0000] {logging_mixin.py:154} INFO -   Columns: 6
[2025-12-08T22:39:48.491+0000] {logging_mixin.py:154} INFO - 
Step 0: Normalizing column names...
[2025-12-08T22:39:48.559+0000] {logging_mixin.py:154} INFO -   Column names normalized (spaces removed)
[2025-12-08T22:39:48.560+0000] {logging_mixin.py:154} INFO - 
Step 1: Cleaning NHTSA_ID...
[2025-12-08T22:39:48.619+0000] {logging_mixin.py:154} INFO - 
Step 2: Extracting document type...
[2025-12-08T22:39:48.782+0000] {logging_mixin.py:154} INFO - 
Step 3: Standardizing manufacturer names...
[2025-12-08T22:39:49.299+0000] {logging_mixin.py:154} INFO - 
Step 4: Filtering to top 15 manufacturers...
[2025-12-08T22:39:49.319+0000] {logging_mixin.py:154} INFO -   ðŸ“Š Filtering to top 15 manufacturers...
[2025-12-08T22:40:00.684+0000] {logging_mixin.py:154} INFO -   âœ“ Kept 117,696 records from top 15 manufacturers
[2025-12-08T22:40:00.686+0000] {logging_mixin.py:154} INFO -   âœ“ Filtered out 112,844 records from other manufacturers
[2025-12-08T22:40:00.686+0000] {logging_mixin.py:154} INFO - 
Step 5: Cleaning MODEL_YEAR...
[2025-12-08T22:40:00.894+0000] {logging_mixin.py:154} INFO - 
Step 6: Cleaning MODEL field...
[2025-12-08T22:40:01.141+0000] {logging_mixin.py:154} INFO - 
Step 7: Cleaning SUMMARY field...
[2025-12-08T22:40:01.362+0000] {logging_mixin.py:154} INFO - 
Step 8: Deduplicating recalls (same recall, multiple documents)...
[2025-12-08T22:40:17.414+0000] {logging_mixin.py:154} INFO -   Removed 48,110 duplicate documents
[2025-12-08T22:40:17.415+0000] {logging_mixin.py:154} INFO -   Unique recalls: 1,210
[2025-12-08T22:40:17.416+0000] {logging_mixin.py:154} INFO - 
Step 9: Adding data quality flags...
[2025-12-08T22:40:17.533+0000] {logging_mixin.py:154} INFO - 
Step 10: Standardizing column names for Snowflake...
[2025-12-08T22:40:17.675+0000] {logging_mixin.py:154} INFO - 
Step 11: Creating standardized vehicle_id...
[2025-12-08T22:40:17.978+0000] {logging_mixin.py:154} INFO - 
Step 12: Adding metadata...
[2025-12-08T22:40:18.049+0000] {logging_mixin.py:154} INFO - 
Step 13: Selecting final columns (Snowflake-ready)...
[2025-12-08T22:40:25.992+0000] {logging_mixin.py:154} INFO - 
Cleaning Summary:
[2025-12-08T22:40:25.993+0000] {logging_mixin.py:154} INFO -   Initial records: 230,540
[2025-12-08T22:40:25.994+0000] {logging_mixin.py:154} INFO -   Final records: 1,210
[2025-12-08T22:40:25.995+0000] {logging_mixin.py:154} INFO -   Deduplication rate: 99.5%
[2025-12-08T22:40:25.996+0000] {logging_mixin.py:154} INFO - 
  Top Manufacturers:
[2025-12-08T22:40:31.476+0000] {logging_mixin.py:154} INFO -     Ford: 283
[2025-12-08T22:40:31.477+0000] {logging_mixin.py:154} INFO -     Mercedes-Benz: 160
[2025-12-08T22:40:31.478+0000] {logging_mixin.py:154} INFO -     BMW: 122
[2025-12-08T22:40:31.479+0000] {logging_mixin.py:154} INFO -     Chevrolet: 107
[2025-12-08T22:40:31.479+0000] {logging_mixin.py:154} INFO -     Jeep: 76
[2025-12-08T22:40:31.480+0000] {logging_mixin.py:154} INFO -     Volkswagen: 72
[2025-12-08T22:40:31.481+0000] {logging_mixin.py:154} INFO -     Honda: 69
[2025-12-08T22:40:31.482+0000] {logging_mixin.py:154} INFO -     Nissan: 69
[2025-12-08T22:40:31.482+0000] {logging_mixin.py:154} INFO -     Kia: 68
[2025-12-08T22:40:31.483+0000] {logging_mixin.py:154} INFO -     Hyundai: 65
[2025-12-08T22:40:31.484+0000] {logging_mixin.py:154} INFO -     Toyota: 64
[2025-12-08T22:40:31.485+0000] {logging_mixin.py:154} INFO -     Subaru: 26
[2025-12-08T22:40:31.485+0000] {logging_mixin.py:154} INFO -     GMC: 14
[2025-12-08T22:40:31.486+0000] {logging_mixin.py:154} INFO -     Tesla: 9
[2025-12-08T22:40:31.487+0000] {logging_mixin.py:154} INFO -     Mazda: 6
[2025-12-08T22:40:31.488+0000] {logging_mixin.py:154} INFO - 
  Recalls by Year:
[2025-12-08T22:40:36.544+0000] {logging_mixin.py:154} INFO -     2020: 360
[2025-12-08T22:40:36.545+0000] {logging_mixin.py:154} INFO -     2021: 255
[2025-12-08T22:40:36.547+0000] {logging_mixin.py:154} INFO -     2022: 224
[2025-12-08T22:40:36.548+0000] {logging_mixin.py:154} INFO -     2023: 168
[2025-12-08T22:40:36.549+0000] {logging_mixin.py:154} INFO -     2024: 136
[2025-12-08T22:40:36.550+0000] {logging_mixin.py:154} INFO -     2025: 51
[2025-12-08T22:40:36.551+0000] {logging_mixin.py:154} INFO - 
Preparing to write cleaned data...
[2025-12-08T22:40:36.675+0000] {logging_mixin.py:154} INFO -    Safety check: Will not delete from non-cleaned path: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/parquet/
[2025-12-08T22:40:36.676+0000] {logging_mixin.py:154} INFO - Writing cleaned data to: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/parquet/
[2025-12-08T22:41:02.871+0000] {logging_mixin.py:154} INFO -    Safety check: Will not delete from non-cleaned path: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/csv/
[2025-12-08T22:41:02.873+0000] {logging_mixin.py:154} INFO - Writing CSV to: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/csv/
[2025-12-08T22:41:18.991+0000] {logging_mixin.py:154} INFO - 
Recalls cleaning complete!
[2025-12-08T22:41:18.992+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-08T22:41:18.993+0000] {logging_mixin.py:154} INFO - 
Sample of cleaned data (Snowflake-ready):
[2025-12-08T22:41:22.681+0000] {logging_mixin.py:154} INFO - +----------------------------------------------------------------+---------------+---------+----------------------+----+
|recall_id                                                       |nhtsa_recall_id|make     |model                 |year|
+----------------------------------------------------------------+---------------+---------+----------------------+----+
|7b04eaaedc786244575299301eb339954ecab250026c548080ed4287f50dd78b|20E013         |BMW      |BRAKE FLUID RES. COVER|NULL|
|19e54cb7d39467781a9c4d459c396197ccd88a367f9618a3c5cf4056c29ee378|20E068         |Honda    |HARD TONNEAU COVERS   |NULL|
|f96cce94d73c27b4a7beac6739dfaf2beb83c25223ffebc074997519f6d3c9e3|20E069         |Ford     |BRAKE PEDAL BRACKET   |NULL|
|e61d062f028f08a4be617aaa9eaede157494768865540fd0d511f0b165714b8d|20E090         |Ford     |F-250 SD              |2020|
|8483ac1e86c8c1ea3a9ab6b2e00cd9c0336405b5a2e4a34637442b25b3e7c0f7|20V022         |Hyundai  |KONA                  |2020|
|bc5b27b544dcf77eb36b5b2101200c549bd5273af1c5e87c418326900adcb000|20V025         |Chevrolet|4500HD                |2020|
|ca59c5e537498a1472ca49b7e6911d677aab91306be8fec23bae0e503b065cd2|20V042         |Jeep     |WRANGLER              |2020|
|0270ad16480c5c51b9e355a3a33b77830978950b4c3a5db59fcdfd28e2d483bd|20V052         |BMW      |X7                    |2020|
|6d708c80ba2e740c29b6126a3585027ae3d4571238b6a362c72cee74ef773b44|20V064         |Toyota   |AVALON HYBRID         |2020|
|344e0e7bb65bcdbbc330a74262a420f9950a1284fb217d1df3c5284157f22c5e|20V066         |Honda    |ODYSSEY               |2020|
+----------------------------------------------------------------+---------------+---------+----------------------+----+
only showing top 10 rows
[2025-12-08T22:41:22.682+0000] {logging_mixin.py:154} INFO - 
Vehicle ID verification (first 5):
[2025-12-08T22:41:30.013+0000] {logging_mixin.py:154} INFO - +----------------------------------------------------------------+-------+----------------------+----+
|vehicle_id                                                      |make   |model                 |year|
+----------------------------------------------------------------+-------+----------------------+----+
|6ac89c27282a32097dca9d5819ec14255ba1a6882f775b47bafeb3775214e17f|BMW    |BRAKE FLUID RES. COVER|NULL|
|8ddd50e17267346d602b4c39c90932c8afd54a116493d89b0a10c585c2d8326f|Honda  |HARD TONNEAU COVERS   |NULL|
|2cfcba4743921830d8b6bca7b8baebfaf6f9fe014f1efcb754d55a675b084548|Ford   |BRAKE PEDAL BRACKET   |NULL|
|571819e453bfab394c179198cfce05a2929dade1068e1c37c1544372f12190b3|Ford   |F-250 SD              |2020|
|b403b88abd7df00ba59be2b364126671ad9bf7163f09a6a2e70168f032bab6a7|Hyundai|KONA                  |2020|
+----------------------------------------------------------------+-------+----------------------+----+
only showing top 5 rows
[2025-12-08T22:41:30.244+0000] {logging_mixin.py:154} INFO - âœ… NHTSA Recalls Complete
[2025-12-08T22:41:30.259+0000] {python.py:194} INFO - Done. Returned value was: True
[2025-12-08T22:41:30.275+0000] {taskinstance.py:1400} INFO - Marking task as SUCCESS. dag_id=autoinsight_cleaning_pipeline_v2, task_id=clean_nhtsa_recalls, execution_date=20251208T223905, start_date=20251208T223906, end_date=20251208T224130
[2025-12-08T22:41:30.299+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-12-08T22:41:30.320+0000] {taskinstance.py:2778} INFO - 1 downstream tasks scheduled from follow-on schedule check
