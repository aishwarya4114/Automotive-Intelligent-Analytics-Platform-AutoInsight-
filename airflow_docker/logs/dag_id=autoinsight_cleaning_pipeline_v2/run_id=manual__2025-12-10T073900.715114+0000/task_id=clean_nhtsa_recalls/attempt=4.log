[2025-12-10T08:34:47.493+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_recalls manual__2025-12-10T07:39:00.715114+00:00 [queued]>
[2025-12-10T08:34:47.508+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_recalls manual__2025-12-10T07:39:00.715114+00:00 [queued]>
[2025-12-10T08:34:47.509+0000] {taskinstance.py:1361} INFO - Starting attempt 4 of 6
[2025-12-10T08:34:47.532+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): clean_nhtsa_recalls> on 2025-12-10 07:39:00.715114+00:00
[2025-12-10T08:34:47.541+0000] {standard_task_runner.py:57} INFO - Started process 1600 to run task
[2025-12-10T08:34:47.545+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'autoinsight_cleaning_pipeline_v2', 'clean_nhtsa_recalls', 'manual__2025-12-10T07:39:00.715114+00:00', '--job-id', '104', '--raw', '--subdir', 'DAGS_FOLDER/autoinsight_cleaning_pipeline.py', '--cfg-path', '/tmp/tmp4ao7u05b']
[2025-12-10T08:34:47.550+0000] {standard_task_runner.py:85} INFO - Job 104: Subtask clean_nhtsa_recalls
[2025-12-10T08:34:47.647+0000] {task_command.py:416} INFO - Running <TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_recalls manual__2025-12-10T07:39:00.715114+00:00 [running]> on host 846744d01d56
[2025-12-10T08:34:47.767+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='autoinsight@example.com' AIRFLOW_CTX_DAG_OWNER='autoinsight-team' AIRFLOW_CTX_DAG_ID='autoinsight_cleaning_pipeline_v2' AIRFLOW_CTX_TASK_ID='clean_nhtsa_recalls' AIRFLOW_CTX_EXECUTION_DATE='2025-12-10T07:39:00.715114+00:00' AIRFLOW_CTX_TRY_NUMBER='4' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-12-10T07:39:00.715114+00:00'
[2025-12-10T08:34:47.772+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-10T08:34:47.772+0000] {logging_mixin.py:154} INFO - CLEANING TASK: NHTSA Recalls
[2025-12-10T08:34:47.773+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-10T08:34:47.991+0000] {logging_mixin.py:154} INFO - 
Starting NHTSA Recalls Cleaning
[2025-12-10T08:34:47.992+0000] {logging_mixin.py:154} INFO - Running in LOCAL mode
[2025-12-10T08:34:47.993+0000] {logging_mixin.py:154} INFO - Loading AWS S3 connectors...
[2025-12-10T08:34:57.176+0000] {logging_mixin.py:154} INFO - Input: s3a://autoinsightfinal/nhtsa/raw/recalls/*.csv
[2025-12-10T08:34:57.177+0000] {logging_mixin.py:154} INFO - Output: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/parquet/
[2025-12-10T08:34:57.178+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-10T08:34:57.178+0000] {logging_mixin.py:154} INFO - NHTSA RECALLS - SPARK CLEANING PIPELINE
[2025-12-10T08:34:57.179+0000] {logging_mixin.py:154} INFO - Input: 2020-2025 data (pre-filtered)
[2025-12-10T08:34:57.179+0000] {logging_mixin.py:154} INFO - Target: Top 15 manufacturers
[2025-12-10T08:34:57.179+0000] {logging_mixin.py:154} INFO - Output: Snowflake-ready with standardized columns
[2025-12-10T08:34:57.180+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-10T08:34:57.181+0000] {logging_mixin.py:154} INFO - 
Reading raw data from: s3a://autoinsightfinal/nhtsa/raw/recalls/*.csv
[2025-12-10T08:35:20.328+0000] {logging_mixin.py:154} INFO -   Loaded 543,620 records (includes duplicate documents)
[2025-12-10T08:35:20.412+0000] {logging_mixin.py:154} INFO -   Columns: 6
[2025-12-10T08:35:20.413+0000] {logging_mixin.py:154} INFO - 
Step 0: Normalizing column names...
[2025-12-10T08:35:20.475+0000] {logging_mixin.py:154} INFO -   Column names normalized (spaces removed)
[2025-12-10T08:35:20.476+0000] {logging_mixin.py:154} INFO - 
Step 1: Cleaning NHTSA_ID...
[2025-12-10T08:35:20.532+0000] {logging_mixin.py:154} INFO - 
Step 2: Extracting document type...
[2025-12-10T08:35:20.629+0000] {logging_mixin.py:154} INFO - 
Step 3: Standardizing manufacturer names...
[2025-12-10T08:35:20.958+0000] {logging_mixin.py:154} INFO - 
Step 4: Filtering to top 15 manufacturers...
[2025-12-10T08:35:20.976+0000] {logging_mixin.py:154} INFO -   ðŸ“Š Filtering to top 15 manufacturers...
[2025-12-10T08:35:30.792+0000] {logging_mixin.py:154} INFO -   âœ“ Kept 245,851 records from top 15 manufacturers
[2025-12-10T08:35:30.793+0000] {logging_mixin.py:154} INFO -   âœ“ Filtered out 297,769 records from other manufacturers
[2025-12-10T08:35:30.794+0000] {logging_mixin.py:154} INFO - 
Step 5: Cleaning MODEL_YEAR...
[2025-12-10T08:35:30.956+0000] {logging_mixin.py:154} INFO - 
Step 6: Cleaning MODEL field...
[2025-12-10T08:35:31.183+0000] {logging_mixin.py:154} INFO - 
Step 7: Cleaning SUMMARY field...
[2025-12-10T08:35:31.390+0000] {logging_mixin.py:154} INFO - 
Step 8: Deduplicating recalls (same recall, multiple documents)...
[2025-12-10T08:35:41.560+0000] {logging_mixin.py:154} INFO -   Removed 49,318 duplicate documents
[2025-12-10T08:35:41.561+0000] {logging_mixin.py:154} INFO -   Unique recalls: 1,271
[2025-12-10T08:35:41.562+0000] {logging_mixin.py:154} INFO - 
Step 9: Adding data quality flags...
[2025-12-10T08:35:41.654+0000] {logging_mixin.py:154} INFO - 
Step 10: Standardizing column names for Snowflake...
[2025-12-10T08:35:41.725+0000] {logging_mixin.py:154} INFO - 
Step 11: Creating standardized vehicle_id...
[2025-12-10T08:35:41.888+0000] {logging_mixin.py:154} INFO - 
Step 12: Adding metadata...
[2025-12-10T08:35:41.949+0000] {logging_mixin.py:154} INFO - 
Step 13: Selecting final columns (Snowflake-ready)...
[2025-12-10T08:35:47.172+0000] {logging_mixin.py:154} INFO - 
Cleaning Summary:
[2025-12-10T08:35:47.173+0000] {logging_mixin.py:154} INFO -   Initial records: 543,620
[2025-12-10T08:35:47.174+0000] {logging_mixin.py:154} INFO -   Final records: 1,271
[2025-12-10T08:35:47.175+0000] {logging_mixin.py:154} INFO -   Deduplication rate: 99.8%
[2025-12-10T08:35:47.175+0000] {logging_mixin.py:154} INFO - 
  Top Manufacturers:
[2025-12-10T08:35:52.306+0000] {logging_mixin.py:154} INFO -     Ford: 290
[2025-12-10T08:35:52.307+0000] {logging_mixin.py:154} INFO -     Mercedes-Benz: 168
[2025-12-10T08:35:52.308+0000] {logging_mixin.py:154} INFO -     BMW: 140
[2025-12-10T08:35:52.309+0000] {logging_mixin.py:154} INFO -     Chevrolet: 116
[2025-12-10T08:35:52.309+0000] {logging_mixin.py:154} INFO -     Jeep: 79
[2025-12-10T08:35:52.310+0000] {logging_mixin.py:154} INFO -     Volkswagen: 73
[2025-12-10T08:35:52.310+0000] {logging_mixin.py:154} INFO -     Honda: 73
[2025-12-10T08:35:52.311+0000] {logging_mixin.py:154} INFO -     Kia: 69
[2025-12-10T08:35:52.312+0000] {logging_mixin.py:154} INFO -     Toyota: 69
[2025-12-10T08:35:52.312+0000] {logging_mixin.py:154} INFO -     Nissan: 69
[2025-12-10T08:35:52.313+0000] {logging_mixin.py:154} INFO -     Hyundai: 68
[2025-12-10T08:35:52.314+0000] {logging_mixin.py:154} INFO -     Subaru: 27
[2025-12-10T08:35:52.315+0000] {logging_mixin.py:154} INFO -     GMC: 14
[2025-12-10T08:35:52.315+0000] {logging_mixin.py:154} INFO -     Tesla: 10
[2025-12-10T08:35:52.316+0000] {logging_mixin.py:154} INFO -     Mazda: 6
[2025-12-10T08:35:52.317+0000] {logging_mixin.py:154} INFO - 
  Recalls by Year:
[2025-12-10T08:36:02.872+0000] {logging_mixin.py:154} INFO -     2020: 414
[2025-12-10T08:36:02.873+0000] {logging_mixin.py:154} INFO -     2021: 255
[2025-12-10T08:36:02.876+0000] {logging_mixin.py:154} INFO -     2022: 224
[2025-12-10T08:36:02.877+0000] {logging_mixin.py:154} INFO -     2023: 168
[2025-12-10T08:36:02.878+0000] {logging_mixin.py:154} INFO -     2024: 136
[2025-12-10T08:36:02.878+0000] {logging_mixin.py:154} INFO -     2025: 51
[2025-12-10T08:36:02.880+0000] {logging_mixin.py:154} INFO - 
Preparing to write cleaned data...
[2025-12-10T08:36:03.063+0000] {logging_mixin.py:154} INFO -    Safety check: Will not delete from non-cleaned path: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/parquet/
[2025-12-10T08:36:03.063+0000] {logging_mixin.py:154} INFO - Writing cleaned data to: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/parquet/
[2025-12-10T08:36:37.123+0000] {logging_mixin.py:154} INFO -    Safety check: Will not delete from non-cleaned path: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/csv/
[2025-12-10T08:36:37.124+0000] {logging_mixin.py:154} INFO - Writing CSV to: s3a://autoinsightfinal/nhtsa/cleaned_new/recalls/csv/
[2025-12-10T08:37:10.802+0000] {logging_mixin.py:154} INFO - 
Recalls cleaning complete!
[2025-12-10T08:37:10.803+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-10T08:37:10.805+0000] {logging_mixin.py:154} INFO - 
Sample of cleaned data (Snowflake-ready):
[2025-12-10T08:37:18.889+0000] {logging_mixin.py:154} INFO - +----------------------------------------------------------------+---------------+----------+-------------------------+----+
|recall_id                                                       |nhtsa_recall_id|make      |model                    |year|
+----------------------------------------------------------------+---------------+----------+-------------------------+----+
|2942ba6be6cf6fdfa2bcb0f2279d65c37a87000d81db78f3de458649aadda06a|16E023         |Honda     |ACCESSORY REAR TRUNK BASE|NULL|
|10174a3a10d36f1bb9311fdfbee732e74b4eb10528ef162bce452b8da9f49913|16E091         |Tesla     |NEMA 10-30 ADAPTER       |NULL|
|54096e4fa8e2f41e529882fa64a9fcfdacdcf4b5d3ce95cc890cd416f5de59e3|17E052         |BMW       |ACCESSORY TURN SIGNAL    |NULL|
|77bd66d386f54ea101f5ca7b191238efbe1ad48c8376be2ee8d889eb551c39df|18E016         |BMW       |ACCESSORY WINDSCREEN     |NULL|
|e5ab67391e9954d66da48a8a085120becb5d15a3bed96f05a9c252e48fd7dd43|18E092         |BMW       |TURBOCORD PORTABLE CHARGE|NULL|
|2b95f69974489f26dac7c50108f21d93ecc19f428b4f9975b59466d78916a277|19E011         |Ford      |MUSTANG                  |NULL|
|37ff68c9571567688700d9913fe81d32a6ff62310ca2110ccf1d5bd49282db2a|19E071         |Honda     |REAR CARRIER             |NULL|
|c52352db36d64aceca2b55308db53f7a813148080069829d96667401f1200982|19V244         |Toyota    |COROLLA HATCHBACK        |2020|
|6d891ebca556b31b8971369288b0e5da6a3ccb7bc3e11b37cfdb39dbcf2af9b1|19V352         |BMW       |230I                     |2020|
|200815792020190da3b3049c81945c146275d853a5a515d153c88427bee1a686|19V389         |Volkswagen|PASSAT                   |2020|
+----------------------------------------------------------------+---------------+----------+-------------------------+----+
only showing top 10 rows
[2025-12-10T08:37:18.891+0000] {logging_mixin.py:154} INFO - 
Vehicle ID verification (first 5):
[2025-12-10T08:37:23.568+0000] {logging_mixin.py:154} INFO - +----------------------------------------------------------------+-----+-------------------------+----+
|vehicle_id                                                      |make |model                    |year|
+----------------------------------------------------------------+-----+-------------------------+----+
|3f1a5eb1101d3fcff7e29d5e8742dd3d7a371792aa1e1b6faa880b514d129df7|Honda|ACCESSORY REAR TRUNK BASE|NULL|
|37504ee689d3160d8a696201e494dfbbe4c353e898806eb4092c5d9de17dc8fb|Tesla|NEMA 10-30 ADAPTER       |NULL|
|6e42eef8909638d42766ffd5857cf16db83d7d1646ab67595dd371a461c41692|BMW  |ACCESSORY TURN SIGNAL    |NULL|
|566af64c56aecb04f7f011d05681368bf22fd1b37f419da7d5bb94a241dcc080|BMW  |ACCESSORY WINDSCREEN     |NULL|
|a2f4640c5ddd156a7e2abb79aba8d1b86ed5e884e6e1290a00e9ef3527f7607b|BMW  |TURBOCORD PORTABLE CHARGE|NULL|
+----------------------------------------------------------------+-----+-------------------------+----+
only showing top 5 rows
[2025-12-10T08:37:24.181+0000] {logging_mixin.py:154} INFO - âœ… NHTSA Recalls Complete
[2025-12-10T08:37:24.229+0000] {python.py:194} INFO - Done. Returned value was: True
[2025-12-10T08:37:24.269+0000] {taskinstance.py:1400} INFO - Marking task as SUCCESS. dag_id=autoinsight_cleaning_pipeline_v2, task_id=clean_nhtsa_recalls, execution_date=20251210T073900, start_date=20251210T083447, end_date=20251210T083724
[2025-12-10T08:37:24.347+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-12-10T08:37:24.419+0000] {taskinstance.py:2778} INFO - 1 downstream tasks scheduled from follow-on schedule check
