[2025-12-10T08:54:46.040+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=non-requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_investigations manual__2025-12-10T08:31:07.500325+00:00 [queued]>
[2025-12-10T08:54:46.054+0000] {taskinstance.py:1159} INFO - Dependencies all met for dep_context=requeueable deps ti=<TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_investigations manual__2025-12-10T08:31:07.500325+00:00 [queued]>
[2025-12-10T08:54:46.058+0000] {taskinstance.py:1361} INFO - Starting attempt 1 of 3
[2025-12-10T08:54:46.079+0000] {taskinstance.py:1382} INFO - Executing <Task(PythonOperator): clean_nhtsa_investigations> on 2025-12-10 08:31:07.500325+00:00
[2025-12-10T08:54:46.090+0000] {standard_task_runner.py:57} INFO - Started process 2239 to run task
[2025-12-10T08:54:46.095+0000] {standard_task_runner.py:84} INFO - Running: ['***', 'tasks', 'run', 'autoinsight_cleaning_pipeline_v2', 'clean_nhtsa_investigations', 'manual__2025-12-10T08:31:07.500325+00:00', '--job-id', '126', '--raw', '--subdir', 'DAGS_FOLDER/autoinsight_cleaning_pipeline.py', '--cfg-path', '/tmp/tmpp8wl0u6c']
[2025-12-10T08:54:46.103+0000] {standard_task_runner.py:85} INFO - Job 126: Subtask clean_nhtsa_investigations
[2025-12-10T08:54:46.213+0000] {task_command.py:416} INFO - Running <TaskInstance: autoinsight_cleaning_pipeline_v2.clean_nhtsa_investigations manual__2025-12-10T08:31:07.500325+00:00 [running]> on host 846744d01d56
[2025-12-10T08:54:46.322+0000] {taskinstance.py:1662} INFO - Exporting env vars: AIRFLOW_CTX_DAG_EMAIL='autoinsight@example.com' AIRFLOW_CTX_DAG_OWNER='autoinsight-team' AIRFLOW_CTX_DAG_ID='autoinsight_cleaning_pipeline_v2' AIRFLOW_CTX_TASK_ID='clean_nhtsa_investigations' AIRFLOW_CTX_EXECUTION_DATE='2025-12-10T08:31:07.500325+00:00' AIRFLOW_CTX_TRY_NUMBER='1' AIRFLOW_CTX_DAG_RUN_ID='manual__2025-12-10T08:31:07.500325+00:00'
[2025-12-10T08:54:46.324+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-10T08:54:46.326+0000] {logging_mixin.py:154} INFO - CLEANING TASK: NHTSA Investigations
[2025-12-10T08:54:46.326+0000] {logging_mixin.py:154} INFO - ======================================================================
[2025-12-10T08:54:46.477+0000] {logging_mixin.py:154} INFO - 
üöÄ Starting NHTSA Investigations Cleaning
[2025-12-10T08:54:46.478+0000] {logging_mixin.py:154} INFO - üîß Running in LOCAL mode
[2025-12-10T08:54:46.478+0000] {logging_mixin.py:154} INFO - üì¶ Loading AWS S3 connectors...
[2025-12-10T08:54:59.489+0000] {logging_mixin.py:154} INFO - üì• Input: s3a://autoinsightfinal/nhtsa/raw/investigations/*.csv
[2025-12-10T08:54:59.490+0000] {logging_mixin.py:154} INFO - üì§ Output: s3a://autoinsightfinal/nhtsa/cleaned_new/investigations/parquet/
[2025-12-10T08:54:59.491+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-10T08:54:59.491+0000] {logging_mixin.py:154} INFO - NHTSA INVESTIGATIONS - SPARK CLEANING PIPELINE
[2025-12-10T08:54:59.492+0000] {logging_mixin.py:154} INFO - Input: 2020-2025 data (pre-filtered)
[2025-12-10T08:54:59.492+0000] {logging_mixin.py:154} INFO - Target: Top 15 manufacturers
[2025-12-10T08:54:59.493+0000] {logging_mixin.py:154} INFO - Output: Snowflake-ready with standardized columns
[2025-12-10T08:54:59.493+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-10T08:54:59.494+0000] {logging_mixin.py:154} INFO - 
üì• Reading raw data from: s3a://autoinsightfinal/nhtsa/raw/investigations/*.csv
[2025-12-10T08:55:38.735+0000] {logging_mixin.py:154} INFO -   ‚úì Loaded 6,886 records (2020-2025)
[2025-12-10T08:55:38.736+0000] {logging_mixin.py:154} INFO - 
üîß Step 1: Standardizing manufacturer names...
[2025-12-10T08:55:39.713+0000] {logging_mixin.py:154} INFO - 
üîß Step 2: Filtering to top 15 manufacturers...
[2025-12-10T08:55:39.753+0000] {logging_mixin.py:154} INFO -   üìä Filtering to top 15 manufacturers...
[2025-12-10T08:56:00.533+0000] {logging_mixin.py:154} INFO -   ‚úì Kept 6,886 records from top 15 manufacturers
[2025-12-10T08:56:00.535+0000] {logging_mixin.py:154} INFO -   ‚úì Filtered out 0 records from other manufacturers
[2025-12-10T08:56:00.536+0000] {logging_mixin.py:154} INFO - 
üîß Step 3: Validating YEAR field...
[2025-12-10T08:56:00.723+0000] {logging_mixin.py:154} INFO - 
üîß Step 4: Cleaning date fields...
[2025-12-10T08:56:01.047+0000] {logging_mixin.py:154} INFO - 
üîß Step 5: Cleaning text fields...
[2025-12-10T08:56:02.085+0000] {logging_mixin.py:154} INFO - 
üîß Step 6: Normalizing component names...
[2025-12-10T08:56:02.458+0000] {logging_mixin.py:154} INFO - 
üîß Step 7: Creating calculated fields...
[2025-12-10T08:56:02.630+0000] {logging_mixin.py:154} INFO - 
üîß Step 8: Processing campaign numbers...
[2025-12-10T08:56:02.746+0000] {logging_mixin.py:154} INFO - 
üîß Step 9: Adding data quality flags...
[2025-12-10T08:56:02.852+0000] {logging_mixin.py:154} INFO - 
üîß Step 10: Removing duplicates...
[2025-12-10T08:56:14.274+0000] {logging_mixin.py:154} INFO -   ‚úì Removed 6,708 duplicate records
[2025-12-10T08:56:14.276+0000] {logging_mixin.py:154} INFO - 
üîß Step 11: Standardizing column names for Snowflake...
[2025-12-10T08:56:14.430+0000] {logging_mixin.py:154} INFO - 
üîß Step 12: Creating standardized vehicle_id...
[2025-12-10T08:56:14.646+0000] {logging_mixin.py:154} INFO - 
üîß Step 13: Adding metadata...
[2025-12-10T08:56:14.762+0000] {logging_mixin.py:154} INFO - 
üîß Step 14: Selecting final columns (Snowflake-ready)...
[2025-12-10T08:56:24.435+0000] {logging_mixin.py:154} INFO - 
üìä Cleaning Summary:
[2025-12-10T08:56:24.436+0000] {logging_mixin.py:154} INFO -   Initial records: 6,886
[2025-12-10T08:56:24.437+0000] {logging_mixin.py:154} INFO -   Final records: 178
[2025-12-10T08:56:24.438+0000] {logging_mixin.py:154} INFO -   Records dropped: 6,708
[2025-12-10T08:56:24.439+0000] {logging_mixin.py:154} INFO -   Retention rate: 2.6%
[2025-12-10T08:56:35.589+0000] {logging_mixin.py:154} INFO - 
  Data Quality:
[2025-12-10T08:56:35.590+0000] {logging_mixin.py:154} INFO -     Missing critical data: 0
[2025-12-10T08:56:35.591+0000] {logging_mixin.py:154} INFO -     Date inconsistencies: 0
[2025-12-10T08:56:35.591+0000] {logging_mixin.py:154} INFO -     Open investigations: 178
[2025-12-10T08:56:35.592+0000] {logging_mixin.py:154} INFO - 
  Top Manufacturers:
[2025-12-10T08:56:44.370+0000] {logging_mixin.py:154} INFO -     Ford: 44
[2025-12-10T08:56:44.377+0000] {logging_mixin.py:154} INFO -     Tesla: 22
[2025-12-10T08:56:44.378+0000] {logging_mixin.py:154} INFO -     Honda: 21
[2025-12-10T08:56:44.378+0000] {logging_mixin.py:154} INFO -     Jeep: 17
[2025-12-10T08:56:44.379+0000] {logging_mixin.py:154} INFO -     Kia: 13
[2025-12-10T08:56:44.380+0000] {logging_mixin.py:154} INFO -     Nissan: 12
[2025-12-10T08:56:44.380+0000] {logging_mixin.py:154} INFO -     Volkswagen: 9
[2025-12-10T08:56:44.382+0000] {logging_mixin.py:154} INFO -     Hyundai: 9
[2025-12-10T08:56:44.382+0000] {logging_mixin.py:154} INFO -     Mercedes-Benz: 8
[2025-12-10T08:56:44.383+0000] {logging_mixin.py:154} INFO -     Chevrolet: 7
[2025-12-10T08:56:44.384+0000] {logging_mixin.py:154} INFO -     GMC: 6
[2025-12-10T08:56:44.385+0000] {logging_mixin.py:154} INFO -     Toyota: 5
[2025-12-10T08:56:44.385+0000] {logging_mixin.py:154} INFO -     BMW: 4
[2025-12-10T08:56:44.386+0000] {logging_mixin.py:154} INFO -     Subaru: 1
[2025-12-10T08:56:44.386+0000] {logging_mixin.py:154} INFO - 
üíæ Preparing to write cleaned data...
[2025-12-10T08:56:44.550+0000] {logging_mixin.py:154} INFO -    Safety check: Will not delete from non-cleaned path: s3a://autoinsightfinal/nhtsa/cleaned_new/investigations/parquet/
[2025-12-10T08:56:44.552+0000] {logging_mixin.py:154} INFO - üíæ Writing cleaned data to: s3a://autoinsightfinal/nhtsa/cleaned_new/investigations/parquet/
[2025-12-10T08:57:21.295+0000] {logging_mixin.py:154} INFO -    Safety check: Will not delete from non-cleaned path: s3a://autoinsightfinal/nhtsa/cleaned_new/investigations/csv/
[2025-12-10T08:57:21.299+0000] {logging_mixin.py:154} INFO - üíæ Writing CSV to: s3a://autoinsightfinal/nhtsa/cleaned_new/investigations/csv/
[2025-12-10T08:57:53.928+0000] {logging_mixin.py:154} INFO - 
‚úÖ Investigations cleaning complete!
[2025-12-10T08:57:53.929+0000] {logging_mixin.py:154} INFO - ============================================================
[2025-12-10T08:57:53.930+0000] {logging_mixin.py:154} INFO - 
üìã Sample of cleaned data (Snowflake-ready):
[2025-12-10T08:57:57.221+0000] {logging_mixin.py:154} INFO - +----------------------------------------------------------------+---------+-------------+----+--------------------+---------+
|investigation_id                                                |make     |model        |year|investigation_status|open_date|
+----------------------------------------------------------------+---------+-------------+----+--------------------+---------+
|b6f753029ee79f8ccd6828ab5f219619ec67f04e4ec36c98561d29463d88d68c|Ford     |F-150        |2015|OPEN                |NULL     |
|cf3d8122ba24ba08aed74ab6305a00c861e8bc0e45bf4df1a5ff91f1bb2e0743|Jeep     |COMPASS      |2017|OPEN                |NULL     |
|e2a50dc7833fe61ee708bac1640cf14ff0edf3de869106999612842f26dbba35|Ford     |TRANSIT      |2017|OPEN                |NULL     |
|1bdbeae9948c5fbaeac43eaf60d74806ff2a084d32a337578b75a7c982396e72|Chevrolet|EXPRESS      |2015|OPEN                |NULL     |
|a25f73d1552c05d48d8f2a6b705aad5afa2e58a9c11b16b1e0651726735a642f|Ford     |ESCAPE       |2021|OPEN                |NULL     |
|a1ae882efa46636603d6c82ec53e1d4c35cd349ecc5aeb47da97d9339945baf8|Nissan   |ALTIMA       |2022|OPEN                |NULL     |
|8b4f0ade410619dd53ad85e2b3d46f75046c1031fa9c711d81050544ea1e3108|Hyundai  |GENESIS COUPE|2015|OPEN                |NULL     |
|7b77b9097e637ae47767f87517b2813f800bed0ad5333ffb4939a984ee37b4e6|Kia      |SELTOS       |2023|OPEN                |NULL     |
|55edd3184b9d4a5067f7078ed0e5446d1442f0cb3c9b5ee8cfd8d34864b9a4ee|Tesla    |MODEL 3      |2020|OPEN                |NULL     |
|94dba88c2a2c37d4b154c257cdfc0d927ffd636ff92bfe2432e3092112a17480|Kia      |SOUL         |2015|OPEN                |NULL     |
+----------------------------------------------------------------+---------+-------------+----+--------------------+---------+
only showing top 10 rows
[2025-12-10T08:57:57.223+0000] {logging_mixin.py:154} INFO - 
üîç Vehicle ID verification (first 5):
[2025-12-10T08:58:06.590+0000] {logging_mixin.py:154} INFO - +----------------------------------------------------------------+---------+-------+----+
|vehicle_id                                                      |make     |model  |year|
+----------------------------------------------------------------+---------+-------+----+
|b71e5b0aaeb50604631469feba003d932588dbaa75383f1fc61e46d412c4caa4|Ford     |F-150  |2015|
|50496dccb573ba6bc92691932e5cc00fffd5d27d8b66ef58236d35901b70de1b|Jeep     |COMPASS|2017|
|273983e72f6ddbf79981c38f18ee04828560356fbe3a22930863da333f1a78f2|Ford     |TRANSIT|2017|
|edc9dc7bb22d1ca7e46a902e256bcb1276fe747d814fcf517f7046481f6aa760|Chevrolet|EXPRESS|2015|
|18c09c7099dad78894c78fc71d38c923d17c61c3d5d0a34c7d687e0d7066475d|Ford     |ESCAPE |2021|
+----------------------------------------------------------------+---------+-------+----+
only showing top 5 rows
[2025-12-10T08:58:07.235+0000] {logging_mixin.py:154} INFO - ‚úÖ NHTSA Investigations Complete
[2025-12-10T08:58:07.275+0000] {python.py:194} INFO - Done. Returned value was: True
[2025-12-10T08:58:07.315+0000] {taskinstance.py:1400} INFO - Marking task as SUCCESS. dag_id=autoinsight_cleaning_pipeline_v2, task_id=clean_nhtsa_investigations, execution_date=20251210T083107, start_date=20251210T085446, end_date=20251210T085807
[2025-12-10T08:58:07.355+0000] {local_task_job_runner.py:228} INFO - Task exited with return code 0
[2025-12-10T08:58:07.404+0000] {taskinstance.py:2778} INFO - 1 downstream tasks scheduled from follow-on schedule check
